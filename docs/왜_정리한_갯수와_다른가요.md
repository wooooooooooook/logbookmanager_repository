# 왜 정리한 갯수와 다른가요?

사용자가 정리한 데이터(분류 결과)와 실제 엑셀/CSV로 내보낸 결과물의 갯수가 다른 이유는 **'내보내기 템플릿(Export Template)'에서 여러 카테고리를 하나로 통합(Merge)하거나 일부를 제외(Exclude)**하기 때문입니다.

모든 규칙 파일(`rules/*.yaml`)은 동일한 `category_id` 체계와 내보내기 템플릿을 공유하므로, 아래의 매핑 규칙이 공통적으로 적용됩니다.

## 1. 상세 매핑 테이블 (Category to Export Code)

아래 표는 내부적으로 사용하는 **분류 ID(Category ID)**가 최종적으로 어떤 **내보내기 코드(Export Code)**로 변환되는지를 보여줍니다.
- **내보내기 코드**는 `구분(Modality) - 세부전공(Specialty)` 형식입니다.
- **통합(Merge)**: 서로 다른 `category_id`가 **동일한 내보내기 코드**를 가리키는 경우, 해당 데이터들은 하나로 합쳐져서 카운트됩니다.

### A. 일반촬영 (X-ray) - Code 1
| Category ID | 한글 이름 | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `xray_neu` | 신경두경부 | **1 - 1** | |
| `xray_cht` | 흉부 | **1 - 2** | |
| `xray_abd` | 복부 | **1 - 3** | |
| `xray_kub` | 비뇨생식기 | **1 - 4** | |
| `xray_spine` | 척추 | **1 - 5** | |
| `xray_msk` | 관절 및 사지 | **1 - 6** | |
| `xray_ped` | 소아 | **1 - 12** | |
| `xray_etc` | 기타 | **1 - 999** | |

### B. CT - Code 2
| Category ID | 한글 이름 | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `ct_neu` | 신경두경부 | **2 - 1** | |
| `ct_cht` | 흉부 | **2 - 2** | |
| `ct_abd` | 복부 | **2 - 3** | |
| `ct_gu` | 비뇨생식기 | **2 - 4** | |
| `ct_spine` | 척추 | **2 - 5** | |
| `ct_msk` | 관절 및 사지 | **2 - 6** | |
| `ct_cardiac` | 심장 | **2 - 8** | |
| `ct_vas` | 혈관 | **2 - 9** | |
| `ct_ped` | 소아 | **2 - 12** | |
| `ct_etc` | 기타 | **2 - 999** | |

### C. MRI - Code 3
| Category ID | 한글 이름 | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `mri_neu` | 신경두경부 | **3 - 1** | |
| `mri_cht` | 흉부 | **3 - 2** | |
| `mri_abd` | 복부 | **3 - 3** | |
| `mri_gu` | 비뇨생식기 | **3 - 4** | |
| `mri_spine` | 척추 | **3 - 5** | |
| `mri_msk` | 관절 및 사지 | **3 - 6** | |
| `mri_breast` | 유방 | **3 - 7** | |
| `mri_cardiac` | 심장 | **3 - 8** | |
| `mri_vas` | 혈관 | **3 - 9** | |
| `mri_ped` | 소아 | **3 - 12** | |
| `mri_etc` | 기타 | **3 - 999** | |

### D. 초음파 (Ultrasound) - Code 4
| Category ID | 한글 이름 | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `ultrasound_head` | 두경부 | **4 - 1** | |
| `ultrasound_abd` | 복부 | **4 - 3** | |
| `ultrasound_gu` | 비뇨기계 | **4 - 4** | |
| `ultrasound_msk` | 근골격계 | **4 - 6** | |
| `ultrasound_breast` | 유방 | **4 - 7** | |
| `ultrasound_thyroid` | 갑상선 | **4 - 10** | |
| `ultrasound_doppler` | 도플러 | **4 - 11** | |
| `ultrasound_ped` | 소아 | **4 - 12** | |
| `ultrasound_etc` | 기타 | **4 - 999** | |

### E. 투시 (Fluoroscopy) - Code 5
| Category ID | 한글 이름 | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `fluoroscopy_abd` | 복부 | **5 - 3** | |
| `fluoroscopy_gu` | 비뇨생식기 | **5 - 4** | |
| `fluoroscopy_ped` | 소아 | **5 - 12** | **통합 주의**: 소아 복부/비뇨 등 하위 분류가 있어도 모두 **5-12**로 통합됩니다. |
| `fluoroscopy_etc` | 기타 | **5 - 999** | |

### F. 유방촬영 (Mammography) - Code 6
| Category ID | 한글 이름 | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `mammography` | 유방촬영 | **6 - 1** | 단일 분류 |

### G. 핵의학 (Nuclear Medicine) - Code 7
| Category ID | 한글 이름 | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `nuclearmedicine_other` | 일반핵의학검사 | **7 - 1** | |
| `nuclearmedicine_pet` | PET/CT | **7 - 2** | |

### H. 시술 (Intervention) - Code 8
| Category ID | 한글 이름 (요약) | 내보내기 코드 | 비고 |
|:---:|:---:|:---:|:---|
| `intervention_neu` | 뇌혈관조영술... | **8 - 1** | |
| `intervention_thyroid` | 초음파 유도하 갑상선... | **8 - 2** | |
| `intervention_us` | 초음파 유도하 경피적... | **8 - 3** | |
| `intervention_ct` | CT 유도하 경피적... | **8 - 4** | |
| `intervention_intu` | 소아 장중첩증 정복술 | **8 - 5** | |
| `intervention_cfa` | 대퇴동맥천자술 | **8 - 6** | |
| `intervention_angio` | 대동맥 및 분지혈관... | **8 - 7** | |
| `intervention_biliary` | 경피적 담도계 배액술... | **8 - 8** | |
| `intervention_pcn` | 경피적신우배액술 | **8 - 9** | |
| `intervention_drain` | 그 외 경피적 배액술... | **8 - 10** | |
| `intervention_cvc` | 중심정맥 카테터 삽입술 | **8 - 11** | |
| `intervention_tumor` | 영상유도하 종양치료... | **8 - 12** | |
| `intervention_etc` | 기타 | **8 - 999** | |

---

## 2. 통합(Merging)이 발생하는 원리
위 표에서 보듯이, **서로 다른 Category ID**를 가지고 있더라도, **내보내기 코드가 같으면** 최종 결과물에서는 합쳐져서 나옵니다.

**예시: 소아 투시의 통합**
- 만약 규칙 파일에 `fluoroscopy_ped_abd`(소아 복부 투시)와 `fluoroscopy_ped_gu`(소아 비뇨 투시)가 별도로 존재하더라도,
- 내보내기 템플릿에서 "소아"라는 이름 전체를 **코드 12**로 매핑하고 있다면,
- 이 두 카테고리는 모두 **5 - 12** (투시 - 소아)로 통합되어 출력됩니다.

## 3. 제외(Exclusion)가 발생하는 원리
위 표에 없는 이름의 카테고리가 규칙 파일에 추가된 경우, 내보내기 템플릿에 해당 이름에 대한 매핑 정보가 없으면 내보내기 시 **제외되거나 에러가 발생**할 수 있습니다.
