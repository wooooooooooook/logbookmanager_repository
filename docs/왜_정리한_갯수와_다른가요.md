# 왜 정리한 갯수와 다른가요?

사용자가 정리한(분류한) 데이터의 갯수와 실제 엑셀/CSV로 내보낸 결과물의 갯수가 다를 수 있습니다. 이는 **분류 규칙(Classification Rules)**과 **내보내기 설정(Export Settings)**이 서로 다른 목적과 기준으로 동작하기 때문입니다.

## 1. 분류 규칙 (Classification Rules)
분류 규칙은 **모든 데이터를 빠짐없이 특정 카테고리로 분류**하는 것을 목표로 합니다.
- **역할**: 각 행(Row)에 대해 정의된 규칙을 검사하여 `category_id`를 부여합니다.
- **결과**: 화면의 '통계'나 '대시보드'에 표시되는 숫자는 이 분류 결과를 바탕으로 계산됩니다.
- **특징**: 데이터의 내용이 불완전하더라도(예: 날짜 누락), 규칙에 맞으면 분류되어 카운트됩니다.

## 2. 내보내기 설정 (Export Settings)
내보내기 설정은 **최종 결과물 파일(Excel/CSV)을 생성**하는 규칙입니다. 이 과정에서 데이터가 제외되거나 합쳐질 수 있습니다.

### 주요 차이 발생 원인

#### A. 필수 데이터 누락으로 인한 제외
내보내기 설정(`export_as_sheet`)에서 특정 컬럼이 필수값으로 지정되어 있거나, 데이터 형식이 맞지 않으면 해당 행은 결과 파일에서 제외될 수 있습니다.
- **예시**: '검사일'(`study_date`)이 없는 데이터는 분류는 되지만, 날짜 필드가 필수인 엑셀 서식에서는 제외될 수 있습니다.

#### B. 템플릿 매핑에 포함되지 않은 카테고리
`template_column_mapping` 설정에 정의되지 않은 카테고리는 내보내기 대상에서 제외되거나 '기타'로 묶일 수 있습니다.
- **예시**:
  - 분류 결과: `Chest_PA` (5건), `Chest_AP` (3건) -> 총 8건
  - 내보내기 매핑: `Chest_PA`만 정의되어 있고 `Chest_AP`는 정의되지 않음.
  - **결과**: 내보내기 파일에는 5건만 기록됨.

#### C. 데이터 통합 (Aggregation)
일부 내보내기 설정(특히 병원 업로드용 포맷)은 개별 건수가 아닌 **집계된 결과**를 요구할 수 있습니다.
- **예시**:
  - 원본 데이터: 같은 날짜, 같은 검사 종류의 데이터 10건
  - 내보내기 결과: 1개의 행에 "건수: 10"으로 요약되어 출력됨.
  - **결과**: 파일의 행 개수는 1개이지만, 실제 데이터는 10건을 포함함.

## 해결 방법
1. **규칙 파일 확인**: `rules` 폴더의 YAML 파일에서 `export_as_sheet` 섹션을 확인하세요.
2. **매핑 확인**: `template_column_mapping`에 모든 카테고리가 올바르게 연결되어 있는지 확인하세요.
3. **데이터 보완**: '미분류' 또는 '필수값 누락' 데이터가 없는지 확인하세요.
